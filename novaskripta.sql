-- MySQL Script generated by MySQL Workbench
-- Sat Jun 27 13:23:17 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`Grad`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Grad` (
  `ptt` INT NOT NULL,
  `naziv` VARCHAR(45) NULL,
  `zemlja` VARCHAR(45) NULL,
  PRIMARY KEY (`ptt`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Lanac hotela`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Lanac hotela` (
  `id_lanca_hotela` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `brTel` VARCHAR(45) NULL,
  `ptt` INT NOT NULL,
  PRIMARY KEY (`id_lanca_hotela`),
  INDEX `fk_Lanac hotela_Grad_idx` (`ptt` ASC) ,
  CONSTRAINT `fk_Lanac hotela_Grad`
    FOREIGN KEY (`ptt`)
    REFERENCES `mydb`.`Grad` (`ptt`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Hotel`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Hotel` (
  `id_hotela` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `brTel` VARCHAR(45) NULL,
  `prijava` TIME NULL,
  `odjava` TIME NULL,
  `kapacitet` INT NULL,
  `broj_zvezdica` INT NULL,
  `id_lanca_hotela` INT NOT NULL,
  `ptt` INT NOT NULL,
  PRIMARY KEY (`id_hotela`),
  INDEX `fk_Hotel_Lanac hotela1_idx` (`id_lanca_hotela` ASC) ,
  INDEX `fk_Hotel_Grad1_idx` (`ptt` ASC) ,
  CONSTRAINT `fk_Hotel_Lanac hotela1`
    FOREIGN KEY (`id_lanca_hotela`)
    REFERENCES `mydb`.`Lanac hotela` (`id_lanca_hotela`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Hotel_Grad1`
    FOREIGN KEY (`ptt`)
    REFERENCES `mydb`.`Grad` (`ptt`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Odeljenje`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Odeljenje` (
  `id_odeljenja` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `opis` VARCHAR(45) NULL,
  PRIMARY KEY (`id_odeljenja`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Zaposleni`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Zaposleni` (
  `id_zaposlenog` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `prezime` VARCHAR(45) NULL,
  `oznaka` VARCHAR(45) NULL,
  `id_hotela` INT NOT NULL,
  `id_odeljenja` INT NOT NULL,
  `ptt` INT NOT NULL,
  PRIMARY KEY (`id_zaposlenog`),
  INDEX `fk_Zaposleni_Hotel1_idx` (`id_hotela` ASC) ,
  INDEX `fk_Zaposleni_Odeljenje1_idx` (`id_odeljenja` ASC) ,
  INDEX `fk_Zaposleni_Grad1_idx` (`ptt` ASC) ,
  CONSTRAINT `fk_Zaposleni_Hotel1`
    FOREIGN KEY (`id_hotela`)
    REFERENCES `mydb`.`Hotel` (`id_hotela`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Zaposleni_Odeljenje1`
    FOREIGN KEY (`id_odeljenja`)
    REFERENCES `mydb`.`Odeljenje` (`id_odeljenja`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Zaposleni_Grad1`
    FOREIGN KEY (`ptt`)
    REFERENCES `mydb`.`Grad` (`ptt`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Gost`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Gost` (
  `id_gosta` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `prezime` VARCHAR(45) NULL,
  `brTel` VARCHAR(45) NULL,
  `platna_kartica` VARCHAR(45) NULL,
  `ptt` INT NOT NULL,
  PRIMARY KEY (`id_gosta`),
  INDEX `fk_Gost_Grad1_idx` (`ptt` ASC) ,
  CONSTRAINT `fk_Gost_Grad1`
    FOREIGN KEY (`ptt`)
    REFERENCES `mydb`.`Grad` (`ptt`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Rezervacija`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Rezervacija` (
  `id_rezervacije` INT NOT NULL,
  `datum` DATETIME NULL,
  `trajanje` VARCHAR(10) NULL,
  `datum_cek` DATETIME NULL,
  `datum_odj` DATETIME NULL,
  `placanje` VARCHAR(45) NULL,
  `iznos` DECIMAL NULL,
  `id_hotela` INT NOT NULL,
  `id_gosta` INT NOT NULL,
  PRIMARY KEY (`id_rezervacije`),
  INDEX `fk_Rezervacija_Hotel1_idx` (`id_hotela` ASC) ,
  INDEX `fk_Rezervacija_Gost1_idx` (`id_gosta` ASC) ,
  CONSTRAINT `fk_Rezervacija_Hotel1`
    FOREIGN KEY (`id_hotela`)
    REFERENCES `mydb`.`Hotel` (`id_hotela`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Rezervacija_Gost1`
    FOREIGN KEY (`id_gosta`)
    REFERENCES `mydb`.`Gost` (`id_gosta`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Usluga hotela`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Usluga hotela` (
  `id_usluge` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `opis` VARCHAR(100) NULL,
  `iznos` DECIMAL NULL,
  PRIMARY KEY (`id_usluge`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Usluge gostiju`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Usluge gostiju` (
  `id_usluge_gostiju` INT NOT NULL,
  `id_usluge` INT NOT NULL,
  `id_rezervacije` INT NOT NULL,
  PRIMARY KEY (`id_usluge_gostiju`, `id_usluge`),
  INDEX `fk_Usluge gostiju_Usluga hotela1_idx` (`id_usluge` ASC) ,
  INDEX `fk_Usluge gostiju_Rezervacija1_idx` (`id_rezervacije` ASC) ,
  CONSTRAINT `fk_Usluge gostiju_Usluga hotela1`
    FOREIGN KEY (`id_usluge`)
    REFERENCES `mydb`.`Usluga hotela` (`id_usluge`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Usluge gostiju_Rezervacija1`
    FOREIGN KEY (`id_rezervacije`)
    REFERENCES `mydb`.`Rezervacija` (`id_rezervacije`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Soba`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Soba` (
  `id_sobe` INT NOT NULL,
  `broj` INT(4) NULL,
  `id_hotela` INT NOT NULL,
  PRIMARY KEY (`id_sobe`),
  INDEX `fk_Soba_Hotel1_idx` (`id_hotela` ASC) ,
  CONSTRAINT `fk_Soba_Hotel1`
    FOREIGN KEY (`id_hotela`)
    REFERENCES `mydb`.`Hotel` (`id_hotela`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Vrsta sobe`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Vrsta sobe` (
  `id_vrste_sobe` INT NOT NULL,
  `ime` VARCHAR(45) NULL,
  `cena` DECIMAL NULL,
  `bez_dima` TINYINT(1) NULL,
  `sa_ljubimcima` TINYINT(1) NULL,
  `id_sobe` INT NOT NULL,
  PRIMARY KEY (`id_vrste_sobe`, `id_sobe`),
  INDEX `fk_Vrsta sobe_Soba1_idx` (`id_sobe` ASC) ,
  CONSTRAINT `fk_Vrsta sobe_Soba1`
    FOREIGN KEY (`id_sobe`)
    REFERENCES `mydb`.`Soba` (`id_sobe`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Popust na sobu`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Popust na sobu` (
  `id_popusta` INT NOT NULL,
  `rata` DECIMAL NULL,
  `poc_mesec` TINYINT(1) NULL,
  `pos_mesec` TINYINT(1) NULL,
  `id_vrste_sobe` INT NOT NULL,
  `id_sobe` INT NOT NULL,
  PRIMARY KEY (`id_popusta`, `id_vrste_sobe`, `id_sobe`),
  INDEX `fk_Popust na sobu_Vrsta sobe1_idx` (`id_vrste_sobe` ASC, `id_sobe` ASC) ,
  CONSTRAINT `fk_Popust na sobu_Vrsta sobe1`
    FOREIGN KEY (`id_vrste_sobe` , `id_sobe`)
    REFERENCES `mydb`.`Vrsta sobe` (`id_vrste_sobe` , `id_sobe`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Rezervisana soba`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Rezervisana soba` (
  `ide_rezervisane_sobe` INT NOT NULL,
  `id_sobe` INT NOT NULL,
  `id_rezervacije` INT NOT NULL,
  PRIMARY KEY (`ide_rezervisane_sobe`, `id_sobe`),
  INDEX `fk_Rezervisana soba_Soba1_idx` (`id_sobe` ASC) ,
  INDEX `fk_Rezervisana soba_Rezervacija1_idx` (`id_rezervacije` ASC) ,
  CONSTRAINT `fk_Rezervisana soba_Soba1`
    FOREIGN KEY (`id_sobe`)
    REFERENCES `mydb`.`Soba` (`id_sobe`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Rezervisana soba_Rezervacija1`
    FOREIGN KEY (`id_rezervacije`)
    REFERENCES `mydb`.`Rezervacija` (`id_rezervacije`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Hotel_has_Usluga hotela`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Hotel_has_Usluga hotela` (
  `id_hotela` INT NOT NULL,
  `id_usluge` INT NOT NULL,
  PRIMARY KEY (`id_hotela`, `id_usluge`),
  INDEX `fk_Hotel_has_Usluga hotela_Usluga hotela1_idx` (`id_usluge` ASC) ,
  INDEX `fk_Hotel_has_Usluga hotela_Hotel1_idx` (`id_hotela` ASC) ,
  CONSTRAINT `fk_Hotel_has_Usluga hotela_Hotel1`
    FOREIGN KEY (`id_hotela`)
    REFERENCES `mydb`.`Hotel` (`id_hotela`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Hotel_has_Usluga hotela_Usluga hotela1`
    FOREIGN KEY (`id_usluge`)
    REFERENCES `mydb`.`Usluga hotela` (`id_usluge`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

insert into Grad (ptt,naziv,zemlja) values (11000,"Beograd","Srbija"),(34000,"Kragujevac","Srbija"),(21000,"Novi Sad","Srbija");
insert into `Lanac hotela`  (id_lanca_hotela,ime,brTel,ptt) values (1,"Elitni hoteli","066-369678",21000),(2,"Prestižni hoteli","069-89731331",11000),(3,"Lanac hotela IZVOR","066-2456789",34000);
insert into Hotel  (id_hotela,ime,brTel,prijava,odjava,kapacitet,broj_zvezdica,id_lanca_hotela,ptt) values (1,"Palic","066-369078",'12:00:00','23:00:00',50,2,1,21000),(2,"ZLatibor","063-339078",'10:00:00','21:00:00',25,3,2,11000),(3,"Gorske Zore","062-339078",'05:00:00','12:00:00',70,3,3,34000);
insert into Odeljenje(id_odeljenja,ime,opis) values (1,'Kuhinja','Kuvanje'),(2,'Ciscenje','Brisanje i pranje'),(3,'Prednje Osoblje','Rukovanje rezervacijama i resavanje upita'),(4,'Menadzment','Obradjuje kupca i resava usluge'),(5,'Komutacija','Uzimanje i odbacivanje');
insert into Zaposleni (id_zaposlenog,ime,prezime,oznaka,id_hotela,id_odeljenja,ptt) values (1,'Marko','Nikolic','Konobar',1,1,34000),(2,'Toma','Peric','Menadzer',3,3,11000),(3,'David','Lazic','Blagajnik',2,2,11000),(4,'Milomir','Antic','Kuvar',2,2,21000),(5,'Anica','Dobric','Menadzer',3,3,34000);
insert into Gost(id_gosta,ime,prezime,brTel,platna_kartica,ptt) values (1,'Mirko','Kodic','132-456-8564',NULL,11000),(2,'Neda','Rakic','132-456-8564',NULL,11000),(3,'Milomir','Rajovic','152-456-8564',NULL,34000),(4,'Bata','Mikic','0664789876',NULL,11000),(5,'Goran','Ristic','0653456789',NULL,21000);
insert into Rezervacija(id_rezervacije,datum,trajanje,datum_cek,datum_odj,placanje,iznos,id_hotela,id_gosta) values (1, '2018-08-08 00:00:00', '5', '2018-08-10 12:00:00', '2018-08-15 23:00:00', 'Kes','3500',1,1),(2, '2018-07-08 00:00:00', '8', '2018-08-10 12:00:00', '2018-08-18 23:00:00', 'Kes','15000',1,4),(3, '2019-03-08 00:00:00', '12', '2018-08-10 12:00:00', '2018-08-22 23:00:00', 'Kes','25000',3,5);
insert into `Usluga hotela` (id_usluge,ime,opis,iznos) values (1,'24-hour Room Service','Postoji usluga koja je na raspolaganju gostima 24h',2000),(2,'Menjacnica','Mogucnost razmene stranih valuta na raspolaganju',500),(3,'Perionica Vesa','Pranje,susenje vesa svakoga dana',1000),(4,'Zabavna soba','Knjige i gledanje filmova',3500),(5,'Bazen','Bazen je pristupacan svim gostima',1000),(6,'Teretana','24h',1500);
insert into `Usluge gostiju` (id_usluge_gostiju,id_usluge,id_rezervacije) values (1,1,1),(2,2,2),(3,2,1),(3,4,3),(4,4,1);
insert into Soba (id_sobe,broj,id_hotela) values (1,1,1),(2,17,2),(3,33,3),(4,4,1),(5,55,3),(6,16,2);
insert into `Vrsta sobe` (id_vrste_sobe,ime,cena,bez_dima,sa_ljubimcima,id_sobe) values (1, 'Standardna soba','5000',0,1,1),(2, 'Standardna dvokrevetna soba','7000',1,1,2),(3, 'Luksuzna soba','10000',0,0,3),(4, 'Klub soba','12000',1,1,4);
insert into `Popust na sobu` (id_popusta,rata,poc_mesec,pos_mesec,id_vrste_sobe,id_sobe) values (1,2000,1,3,1,1),(2,3000,1,5,2,2),(3,5000,1,8,3,3),(4,5500,1,11,4,4);
insert into `Rezervisana soba`(ide_rezervisane_sobe,id_sobe,id_rezervacije) values (1,1,1);
insert into `Rezervisana soba`(ide_rezervisane_sobe,id_sobe,id_rezervacije) values (2,2,2);
insert into `Rezervisana soba`(ide_rezervisane_sobe,id_sobe,id_rezervacije) values (3,3,3);
insert into `Hotel_has_Usluga hotela` (id_hotela,id_usluge) values (1,2),(2,1),(3,3);

select count(*) from Hotel; 
SELECT BROJ 
FROM SOBA 
WHERE ID_HOTELA=2;
SELECT IME,PREZIME
FROM ZAPOSLENI 
WHERE OZNAKA="Menadzer";
SELECT IME,PREZIME
FROM GOST G ,GRAD GR
WHERE G.PTT=GR.PTT AND NAZIV="Kragujevac";
SELECT *
FROM REZERVACIJA
WHERE ID_HOTELA=(SELECT ID_HOTELA
				FROM HOTEL
                WHERE BROJ_ZVEZDICA=2);
SELECT KAPACITET 
FROM HOTEL H,`Lanac hotela` L
WHERE H.ID_LANCA_HOTELA=L.ID_LANCA_HOTELA
AND L.PTT LIKE "_1%";
SELECT BROJ
FROM SOBA S,`Popust na sobu` P
where S.ID_SOBE=P.ID_SOBE AND P.RATA < 6000;
SELECT IME,CENA
FROM `Vrsta sobe`
GROUP BY IME
ORDER BY CENA DESC;
